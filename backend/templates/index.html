<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaralPolicy - AI Insurance Analysis</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Noto+Sans+Devanagari:wght@300;400;500;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        :root {
            --primary: #6750A4;
            --primary-light: #EADDFF;
            --secondary: #625B71;
            --surface: #FFFBFE;
            --surface-variant: #E7E0EC;
            --error: #BA1A1A;
            --success: #198754;
            --text: #1C1B1F;
            --text-secondary: #49454F;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'Noto Sans Devanagari', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: linear-gradient(135deg, var(--primary) 0%, #9333EA 100%);
            border-radius: 24px;
            color: white;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            position: relative;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .header .tagline {
            font-size: 1.5rem;
            font-weight: 500;
            opacity: 0.95;
            margin-bottom: 8px;
        }

        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.85;
        }

        .lang-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 8px;
            display: flex;
            gap: 8px;
        }

        .lang-btn {
            background: transparent;
            border: 2px solid white;
            color: white;
            padding: 8px 20px;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: white;
            color: var(--primary);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(103, 80, 164, 0.1);
        }

        .card h2 {
            margin-bottom: 20px;
            color: var(--primary);
            font-weight: 600;
            font-size: 1.5rem;
        }

        .upload-area {
            border: 3px dashed var(--primary);
            border-radius: 16px;
            padding: 50px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--primary-light);
        }

        .upload-area:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(103, 80, 164, 0.2);
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 1.25rem;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .upload-subtext {
            color: #49454F;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 24px;
            padding: 16px 32px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(103, 80, 164, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            justify-content: center;
            margin-top: 20px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(103, 80, 164, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .feature-item {
            padding: 20px;
            margin-bottom: 16px;
            border-radius: 12px;
            background: var(--surface-variant);
            transition: all 0.3s;
        }

        .feature-item:hover {
            transform: translateX(8px);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 8px;
            color: var(--primary);
        }

        .feature-title {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 1.1rem;
        }

        .feature-desc {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .results-section {
            grid-column: 1 / -1;
            display: none;
            animation: fadeIn 0.5s;
        }

        .results-section.show {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--primary);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .result-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .result-content {
            color: var(--text);
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .tts-controls {
            display: flex;
            gap: 10px;
        }

        .tts-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 10px 16px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .tts-btn:hover {
            background: #5640a0;
            transform: scale(1.05);
        }

        .tts-btn .material-icons {
            font-size: 18px;
        }

        .term-item {
            padding: 16px;
            margin-bottom: 12px;
            background: var(--surface-variant);
            border-radius: 10px;
            border-left: 3px solid var(--success);
        }

        .term-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary);
            margin-bottom: 6px;
        }

        .term-definition {
            color: var(--text);
            font-size: 1rem;
        }

        .exclusion-item {
            padding: 12px 20px;
            margin-bottom: 10px;
            background: #fff3cd;
            border-radius: 8px;
            border-left: 3px solid #ff9800;
            display: flex;
            align-items: start;
            gap: 10px;
        }

        .coverage-item {
            display: grid;
            grid-template-columns: 200px 1fr;
            padding: 12px 0;
            border-bottom: 1px solid var(--surface-variant);
        }

        .coverage-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .coverage-value {
            color: var(--text);
            font-weight: 500;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--surface-variant);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .metric-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .metric-high {
            background: #d4edda;
            color: #155724;
        }

        .metric-medium {
            background: #fff3cd;
            color: #856404;
        }

        .metric-low {
            background: #f8d7da;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 24px 16px;
                margin-bottom: 24px;
            }

            .header h1 {
                font-size: 1.75rem;
            }

            .header .tagline {
                font-size: 1.1rem;
            }

            .header .subtitle {
                font-size: 0.95rem;
            }

            .lang-toggle {
                position: relative;
                top: 0;
                right: 0;
                margin-top: 16px;
                justify-content: center;
            }
        }

        .consent-container {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin: 16px 0;
            padding: 12px;
            background: #f0f8ff;
            border-radius: 10px;
            border: 1px solid #ddd;
        }

        .consent-container input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
        }

        .consent-container label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .consent-container a {
            color: var(--primary);
        }

        .trust-badges {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .trust-badge {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        footer {
            text-align: center;
            padding: 30px 20px;
            margin-top: 40px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
            margin: 0 12px;
        }

        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="lang-toggle">
                <button class="lang-btn active" onclick="switchLanguage('en')" id="langEnBtn">English</button>
                <button class="lang-btn" onclick="switchLanguage('hi')" id="langHiBtn">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
            </div>
            <h1 id="appTitle">üìÑ SaralPolicy</h1>
            <div class="tagline" id="tagline">Insurance ka fine print, ab saaf saaf.</div>
            <p class="subtitle" id="subtitle">AI-Powered Insurance Document Analysis with Complete Privacy</p>
        </div>

        <div class="main-grid">
            <div class="card">
                <h2 id="uploadTitle">Upload Policy Document</h2>
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">üìÅ</div>
                    <div class="upload-text" id="uploadText">Drop your policy here or click to browse</div>
                    <div class="upload-subtext" id="uploadSubtext">Supports PDF, DOCX, TXT (max 10MB)</div>
                    <input type="file" id="fileInput" style="display: none;" accept=".pdf,.docx,.txt"
                        onchange="handleFileSelect(event)">
                </div>
                <div class="consent-container">
                    <input type="checkbox" id="consentCheck" onchange="updateConsentState()">
                    <label for="consentCheck">
                        I consent to local processing of my document for analysis.
                        <a href="/privacy" target="_blank">Privacy Policy</a>
                    </label>
                </div>
                <div class="trust-badges">
                    <span class="trust-badge">üõ°Ô∏è 100% Local</span>
                    <span class="trust-badge">‚úÖ DPDP Compliant</span>
                </div>
                <button class="btn" id="analyzeBtn" onclick="analyzeDocument()" disabled>
                    <span class="material-icons" style="display:none">analytics</span>
                    <span style="margin-right:8px; font-size:1.2rem;">üìä</span>
                    <span id="analyzeBtnText">Analyze Policy</span>
                </button>
            </div>

            <div class="card">
                <h2 id="featuresTitle">Key Features</h2>
                <div class="feature-item">
                    <div class="feature-icon">ü§ñ</div>
                    <div class="feature-title" id="feature1Title">100% Local AI Processing</div>
                    <div class="feature-desc" id="feature1Desc">No cloud uploads - your data stays on your device</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">üîí</div>
                    <div class="feature-title" id="feature2Title">Complete Privacy</div>
                    <div class="feature-desc" id="feature2Desc">Zero data leakage with advanced PII protection</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">üéØ</div>
                    <div class="feature-title" id="feature3Title">Smart Analysis</div>
                    <div class="feature-desc" id="feature3Desc">Extracts key terms, coverage, and exclusions
                        automatically</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">üîä</div>
                    <div class="feature-title" id="feature4Title">Text-to-Speech</div>
                    <div class="feature-desc" id="feature4Desc">Listen to your policy in Hindi or English</div>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loadingText">Analyzing your policy document...</p>
        </div>

        <div class="results-section card" id="resultsSection">
            <h2 id="resultsTitle">üìä Analysis Results</h2>
            <div id="resultsContent"></div>

            <div class="qa-section" id="qaSection"
                style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                <h3 style="color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5rem;">üí¨</span>
                    Ask about this Policy
                </h3>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <input type="text" id="qaInput" placeholder="E.g., Does this cover dental treatment?"
                        style="flex: 1; padding: 12px 20px; border: 2px solid var(--surface-variant); border-radius: 12px; font-size: 1rem; outline: none; transition: border-color 0.3s;"
                        onkeypress="if(event.key === 'Enter') askQuestion()">
                    <button class="btn" onclick="askQuestion()" style="margin-top: 0; width: auto; padding: 12px 24px;">
                        ‚û°Ô∏è Ask
                    </button>
                </div>

                <div id="qaLoading" style="display: none; color: var(--text-secondary); margin-bottom: 15px;">
                    <span class="spinner"
                        style="width: 20px; height: 20px; border-width: 2px; display: inline-block; vertical-align: middle; margin: 0 10px 0 0;"></span>
                    Thinking...
                </div>

                <div id="qaResult"
                    style="display: none; background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid var(--primary);">
                    <div id="qaAnswer" style="margin-bottom: 15px; font-weight: 500; color: var(--text);"></div>
                    <div id="qaSources" style="font-size: 0.9rem; color: var(--text-secondary);"></div>
                </div>
            </div>

            <div
                style="margin-top: 20px; font-size: 0.8rem; color: #666; background: #f0f0f0; padding: 10px; border-radius: 8px; text-align: center;">
                <strong>‚ö†Ô∏è Disclaimer:</strong> SaralPolicy uses AI to assist in understanding insurance documents.
                AI can make mistakes. This analysis is for informational purposes only and does not constitute legal or
                financial advice.
                Always verify important details with your official policy document or insurance provider.
            </div>
        </div>
    </div>

    <footer>
        <a href="/privacy">Privacy Policy</a> |
        <a href="mailto:vikassahani17@gmail.com">Contact</a> |
        <span>¬© 2025 All rights reserved VIKAS SAHANI and copyright to owner and third party trademark if any
            involved.</span>
    </footer>

    <script>
        let selectedFile = null;
        let analysisData = null;
        let currentLanguage = 'en';
        let audioElement = null;

        const translations = {
            en: {
                appTitle: "üìÑ SaralPolicy",
                tagline: "Insurance ka fine print, ab saaf saaf.",
                subtitle: "AI-Powered Insurance Document Analysis with Complete Privacy",
                uploadTitle: "Upload Policy Document",
                uploadText: "Drop your policy here or click to browse",
                uploadSubtext: "Supports PDF, DOCX, TXT (max 10MB)",
                analyzeBtnText: "Analyze Policy",
                featuresTitle: "Key Features",
                feature1Title: "100% Local AI Processing",
                feature1Desc: "No cloud uploads - your data stays on your device",
                feature2Title: "Complete Privacy",
                feature2Desc: "Zero data leakage with advanced PII protection",
                feature3Title: "Smart Analysis",
                feature3Desc: "Extracts key terms, coverage, and exclusions automatically",
                feature4Title: "Text-to-Speech",
                feature4Desc: "Listen to your policy in Hindi or English",
                loadingText: "Analyzing your policy document...",
                resultsTitle: "üìä Analysis Results",
                policySummary: "Policy Summary",
                keyTerms: "Important Terms",
                exclusions: "Exclusions & Limitations",
                coverage: "Coverage Details",
                qualityMetrics: "Quality Metrics",
                confidenceScore: "Confidence Score",
                qualityGrade: "Quality Grade",
                expertReview: "‚ö†Ô∏è Requires Expert Review"
            },
            hi: {
                appTitle: "üìÑ ‡§∏‡§∞‡§≤ ‡§™‡•â‡§≤‡§ø‡§∏‡•Ä",
                tagline: "‡§¨‡•Ä‡§Æ‡§æ ‡§ï‡•Ä ‡§õ‡•ã‡§ü‡•Ä ‡§≤‡§ø‡§ñ‡§æ‡§µ‡§ü, ‡§Ö‡§¨ ‡§∏‡§æ‡§´‡§º-‡§∏‡§æ‡§´‡§º‡•§",
                subtitle: "‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ó‡•ã‡§™‡§®‡•Ä‡§Ø‡§§‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• AI-‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§ ‡§¨‡•Ä‡§Æ‡§æ ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£",
                uploadTitle: "‡§™‡•â‡§≤‡§ø‡§∏‡•Ä ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
                uploadText: "‡§Ø‡§π‡§æ‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§™‡•â‡§≤‡§ø‡§∏‡•Ä ‡§õ‡•ã‡§°‡§º‡•á‡§Ç ‡§Ø‡§æ ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç",
                uploadSubtext: "PDF, DOCX, TXT ‡§∏‡§Æ‡§∞‡•ç‡§•‡§ø‡§§ (‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ 10MB)",
                analyzeBtnText: "‡§™‡•â‡§≤‡§ø‡§∏‡•Ä ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç",
                featuresTitle: "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§µ‡§ø‡§∂‡•á‡§∑‡§§‡§æ‡§è‡§Ç",
                feature1Title: "100% ‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø AI ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏‡§ø‡§Ç‡§ó",
                feature1Desc: "‡§ï‡•ã‡§à ‡§ï‡•ç‡§≤‡§æ‡§â‡§° ‡§Ö‡§™‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç - ‡§Ü‡§™‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§Ü‡§™‡§ï‡•á ‡§°‡§ø‡§µ‡§æ‡§á‡§∏ ‡§™‡§∞ ‡§∞‡§π‡§§‡§æ ‡§π‡•à",
                feature2Title: "‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ó‡•ã‡§™‡§®‡•Ä‡§Ø‡§§‡§æ",
                feature2Desc: "‡§â‡§®‡•ç‡§®‡§§ PII ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§°‡•á‡§ü‡§æ ‡§∞‡§ø‡§∏‡§æ‡§µ",
                feature3Title: "‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£",
                feature3Desc: "‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∂‡§∞‡•ç‡§§‡•á‡§Ç, ‡§ï‡§µ‡§∞‡•á‡§ú ‡§î‡§∞ ‡§¨‡§π‡§ø‡§∑‡•ç‡§ï‡§∞‡§£ ‡§®‡§ø‡§ï‡§æ‡§≤‡§§‡§æ ‡§π‡•à",
                feature4Title: "‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü-‡§ü‡•Ç-‡§∏‡•ç‡§™‡•Ä‡§ö",
                feature4Desc: "‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Ø‡§æ ‡§Ö‡§Ç‡§ó‡•ç‡§∞‡•á‡§ú‡§º‡•Ä ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§®‡•Ä ‡§™‡•â‡§≤‡§ø‡§∏‡•Ä ‡§∏‡•Å‡§®‡•á‡§Ç",
                loadingText: "‡§Ü‡§™‡§ï‡•Ä ‡§™‡•â‡§≤‡§ø‡§∏‡•Ä ‡§¶‡§∏‡•ç‡§§‡§æ‡§µ‡•á‡§ú‡§º ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...",
                resultsTitle: "üìä ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ",
                policySummary: "‡§™‡•â‡§≤‡§ø‡§∏‡•Ä ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂",
                keyTerms: "‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∂‡§∞‡•ç‡§§‡•á‡§Ç",
                exclusions: "‡§¨‡§π‡§ø‡§∑‡•ç‡§ï‡§∞‡§£ ‡§î‡§∞ ‡§∏‡•Ä‡§Æ‡§æ‡§è‡§Ç",
                coverage: "‡§ï‡§µ‡§∞‡•á‡§ú ‡§µ‡§ø‡§µ‡§∞‡§£",
                qualityMetrics: "‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§Æ‡•á‡§ü‡•ç‡§∞‡§ø‡§ï‡•ç‡§∏",
                confidenceScore: "‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§∏‡•ç‡§ï‡•ã‡§∞",
                qualityGrade: "‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§ó‡•ç‡§∞‡•á‡§°",
                expertReview: "‚ö†Ô∏è ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û ‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï"
            }
        };

        function switchLanguage(lang) {
            currentLanguage = lang;
            document.getElementById('langEnBtn').classList.toggle('active', lang === 'en');
            document.getElementById('langHiBtn').classList.toggle('active', lang === 'hi');

            const t = translations[lang];
            for (const key in t) {
                const elem = document.getElementById(key);
                if (elem) elem.textContent = t[key];
            }
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                selectedFile = file;
                document.getElementById('uploadText').textContent = `Selected: ${file.name}`;
                document.getElementById('uploadSubtext').textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
                updateConsentState();
            }
        }

        function updateConsentState() {
            const consentGiven = document.getElementById('consentCheck').checked;
            const fileSelected = !!selectedFile;
            document.getElementById('analyzeBtn').disabled = !(consentGiven && fileSelected);
        }

        async function analyzeDocument() {
            if (!selectedFile) return;

            const formData = new FormData();
            formData.append('file', selectedFile);

            document.getElementById('loading').classList.add('show');
            document.getElementById('analyzeBtn').disabled = true;

            try {
                const response = await fetch('/upload', { method: 'POST', body: formData });

                if (response.ok) {
                    const result = await response.json();
                    analysisData = result.analysis;
                    await displayResults(result);
                } else {
                    const error = await response.json();
                    showError(error.detail || 'Analysis failed');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            } finally {
                document.getElementById('loading').classList.remove('show');
                document.getElementById('analyzeBtn').disabled = false;
            }
        }

        async function displayResults(result) {
            const resultsContent = document.getElementById('resultsContent');
            const analysis = result.analysis;
            const t = translations[currentLanguage];

            // Use emoji icons as fallback (works offline, no font dependency)
            let html = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">
                            üìã ${t.policySummary}
                        </div>
                        <div class="tts-controls">
                            <button class="tts-btn" onclick="speakText('${escapeHtml(analysis.summary || '')}', 'en')">
                                üîä EN
                            </button>
                            <button class="tts-btn" onclick="speakText('${escapeHtml(analysis.summary || '')}', 'hi')">
                                üîä HI
                            </button>
                        </div>
                    </div>
                    <div class="result-content" style="white-space: pre-wrap; line-height: 1.6;">${formatText(analysis.summary || 'No summary available')}</div>
                </div>
            `;

            if (analysis.key_terms && analysis.key_terms.length) {
                html += `<div class="result-card">
                    <div class="result-title">
                        üîë ${t.keyTerms}
                    </div>
                    <div class="result-content">`;

                analysis.key_terms.forEach(term => {
                    const termName = formatText(term.term || term.name || 'Term');
                    const termDef = formatText(term.definition || term.description || '');
                    html += `<div class="term-item">
                        <div class="term-name">${termName}</div>
                        <div class="term-definition">${termDef}</div>
                    </div>`;
                });

                html += `</div></div>`;
            }

            if (analysis.exclusions && analysis.exclusions.length) {
                html += `<div class="result-card">
                    <div class="result-title">
                        üö´ ${t.exclusions}
                    </div>
                    <div class="result-content">`;

                analysis.exclusions.forEach(item => {
                    const exclusionText = typeof item === 'string' ? item : (item.exclusion || item.title || JSON.stringify(item));
                    const explanation = item.explanation || item.impact || '';
                    html += `<div class="exclusion-item">
                        <span style="color: #ff9800; font-size: 1.2rem;">‚ö†Ô∏è</span>
                        <div>
                            <strong>${formatText(exclusionText)}</strong>
                            ${explanation ? `<br><small>${formatText(explanation)}</small>` : ''}
                        </div>
                    </div>`;
                });

                html += `</div></div>`;
            }

            if (analysis.coverage_details && Object.keys(analysis.coverage_details).length > 0) {
                html += `<div class="result-card">
                    <div class="result-title">
                        üìä ${t.coverage}
                    </div>
                    <div class="result-content">`;

                for (const [key, value] of Object.entries(analysis.coverage_details)) {
                    html += `<div class="coverage-item">
                        <div class="coverage-label">${formatLabel(key)}</div>
                        <div class="coverage-value">${formatText(String(value))}</div>
                    </div>`;
                }

                html += `</div></div>`;
            }

            if (analysis.evaluation || analysis.confidence_score !== undefined) {
                const score = analysis.confidence_score || analysis.evaluation?.confidence_score || 0;
                const grade = analysis.quality_grade || analysis.evaluation?.quality_grade || 'N/A';

                html += `<div class="result-card">
                    <div class="result-title">
                        üèÜ ${t.qualityMetrics}
                    </div>
                    <div class="result-content">
                        <span class="metric-badge ${score > 0.85 ? 'metric-high' : score > 0.7 ? 'metric-medium' : 'metric-low'}">
                            ${t.confidenceScore}: ${(score * 100).toFixed(1)}%
                        </span>
                        <span class="metric-badge metric-medium">
                            ${t.qualityGrade}: ${grade}
                        </span>
                        ${analysis.hitl_triggered || analysis.requires_hitl_review ?
                        `<div style="margin-top: 16px; color: var(--error); font-weight: 600;">${t.expertReview}</div>` : ''}
                    </div>
                </div>`;
            }

            resultsContent.innerHTML = html;
            document.getElementById('resultsSection').classList.add('show');
            
            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        async function speakText(text, language) {
            try {
                // Stop any currently playing audio
                if (audioElement) {
                    audioElement.pause();
                    audioElement = null;
                }

                console.log('Generating speech via backend TTS...');

                const response = await fetch('/tts/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text, language: language })
                });

                if (response.ok) {
                    const result = await response.json();
                    audioElement = new Audio(result.audio_url);
                    audioElement.play();
                    console.log('Playing audio...');
                } else {
                    console.error('TTS generation failed');
                    alert('Text-to-speech service unavailable');
                }
            } catch (error) {
                console.error('TTS Error:', error);
                alert('Text-to-speech failed: ' + error.message);
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/'/g, '&apos;').replace(/"/g, '&quot;');
        }

        function formatText(text) {
            // Clean up markdown and formatting artifacts from LLM output
            let cleaned = text
                // Remove markdown bold/italic
                .replace(/\*\*([^*]+)\*\*/g, '$1')
                .replace(/\*([^*]+)\*/g, '$1')
                .replace(/__([^_]+)__/g, '$1')
                .replace(/_([^_]+)_/g, '$1')
                // Remove markdown headers
                .replace(/^#{1,6}\s+/gm, '')
                // Remove markdown bullet points, replace with proper bullets
                .replace(/^\s*[-*]\s+/gm, '‚Ä¢ ')
                // Remove markdown code blocks
                .replace(/```[^`]*```/g, '')
                .replace(/`([^`]+)`/g, '$1')
                // Clean up extra whitespace
                .replace(/\n{3,}/g, '\n\n')
                .trim();
            
            return cleaned.replace(/\n/g, '<br>');
        }

        function formatLabel(label) {
            return label.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function showError(message) {
            document.getElementById('resultsContent').innerHTML = `
                <div class="result-card" style="border-left-color: var(--error);">
                    <div class="result-title" style="color: var(--error);">
                        ‚ö†Ô∏è
                        Error
                    </div>
                    <div class="result-content" style="color: var(--error);">${message}</div>
                </div>
            `;
            document.getElementById('resultsSection').classList.add('show');
        }

        // Drag and drop
        const uploadArea = document.querySelector('.upload-area');
        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.style.transform = 'scale(1.02)'; });
        uploadArea.addEventListener('dragleave', () => { uploadArea.style.transform = 'scale(1)'; });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.transform = 'scale(1)';
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                document.getElementById('fileInput').files = files;
                handleFileSelect({ target: { files: files } });
            }
        });

        // Ask Question Logic
        async function askQuestion() {
            const input = document.getElementById('qaInput');
            const question = input.value.trim();
            if (!question) return;

            document.getElementById('qaLoading').style.display = 'block';
            document.getElementById('qaResult').style.display = 'none';
            input.disabled = true;

            try {
                const response = await fetch('/ask_document', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: question })
                });

                const result = await response.json();

                if (response.ok) {
                    // Logic for HITL / Confidence Warning (Accountability)
                    const confidence = result.confidence !== undefined ? result.confidence : 1.0;
                    const hitlThreshold = 0.70;

                    let answerHtml = formatText(result.answer || "No answer returned.");

                    if (confidence < hitlThreshold) {
                        const warningHtml = `
                            <div style="background-color: #fff3cd; color: #856404; padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ffc107; display: flex; align-items: start; gap: 10px;">
                                ‚ö†Ô∏è
                                <div>
                                    <strong>Expert Review Recommended:</strong> 
                                    The AI is only ${(confidence * 100).toFixed(0)}% confident in this answer. 
                                    Please verify strictly with the Policy Document sources below.
                                </div>
                            </div>
                         `;
                        answerHtml = warningHtml + answerHtml;
                    }

                    // Display Answer
                    document.getElementById('qaAnswer').innerHTML = answerHtml;

                    // Display Citations (Phase 2: Explainability)
                    const sourcesDiv = document.getElementById('qaSources');
                    if (result.document_excerpts && result.document_excerpts.length > 0) {
                        let sourcesHtml = '<div style="margin-top: 20px; border-top: 1px dashed #ccc; padding-top: 10px;">';
                        sourcesHtml += '<strong style="color: var(--primary);">üìö Source Evidence:</strong><br>';

                        result.document_excerpts.forEach((excerpt, index) => {
                            const pageInfo = excerpt.page_num ? `(Page ${excerpt.page_num})` : '';
                            const conf = excerpt.confidence ? `‚Ä¢ Confidence: ${(excerpt.confidence * 100).toFixed(0)}%` : '';

                            sourcesHtml += `
                                <div style="margin-top: 8px; font-size: 0.9rem; background: #fff; padding: 12px; border-radius: 8px; border: 1px solid #e0e0e0; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                                    <div style="color: var(--primary); font-weight: 600; margin-bottom: 4px; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.5px;">
                                        SOURCE ${index + 1} ${pageInfo} ${conf}
                                    </div>
                                    <div style="color: #444; line-height: 1.5;">${excerpt.text}</div>
                                </div>
                            `;
                        });
                        sourcesHtml += '</div>';
                        sourcesDiv.innerHTML = sourcesHtml;
                    } else {
                        sourcesDiv.innerHTML = '<span style="font-style: italic; color: #666; font-size: 0.85rem;">Answer generated from general context. No specific excerpts cited.</span>';
                    }

                    document.getElementById('qaResult').style.display = 'block';
                } else {
                    showError(result.detail || 'Failed to get answer');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            } finally {
                document.getElementById('qaLoading').style.display = 'none';
                input.disabled = false;
                input.focus();
            }
        }

        // Event delegation for TTS buttons
        document.addEventListener('click', function (e) {
            if (e.target.closest('.tts-btn')) {
                const btn = e.target.closest('.tts-btn');
                const text = btn.getAttribute('data-tts-text');
                const lang = btn.getAttribute('data-tts-lang');
                if (text && lang) {
                    speakText(text, lang);
                }
            }
        });
    </script>
</body>

</html>